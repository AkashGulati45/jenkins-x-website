<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jenkins X - Cloud Native CI/CD Built On Kubernetes – Secrets</title>
    <link>/docs/labs/boot/getting-started/secrets/</link>
    <description>Recent content in Secrets on Jenkins X - Cloud Native CI/CD Built On Kubernetes</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="/docs/labs/boot/getting-started/secrets/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Docs: Vault</title>
      <link>/docs/labs/boot/getting-started/secrets/vault/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/docs/labs/boot/getting-started/secrets/vault/</guid>
      <description>
        
        
        

&lt;div class=&#34;alert alert-primary&#34; role=&#34;alert&#34;&gt;

&lt;p&gt;&lt;strong&gt;NOTE: This current experiment is now closed. The work done and feedback we have received will be used to enhance Jenkins X in future versions&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;This code should not be used in production, or be adopted for usage.  It should only be used to provide feedback to the Labs team.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Thank you for your participation,&lt;/p&gt;
&lt;p&gt;-Labs&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;To be able to use Vault as the storage engine for your Secrets you need to specify &lt;code&gt;--secret vault&lt;/code&gt; when &lt;a href=&#34;/docs/labs/boot/getting-started/repository/&#34;&gt;creating your development git repository&lt;/a&gt; or &lt;a href=&#34;/docs/labs/boot/getting-started/config/#vault&#34;&gt;configure vault&lt;/a&gt; via &lt;code&gt;secretStorage: vault&lt;/code&gt; in your &lt;code&gt;jx-requirements.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;cluster&lt;/span&gt;:
  &lt;span style=&#34;color:#66d9ef&#34;&gt;provider&lt;/span&gt;: gke
&lt;span style=&#34;color:#66d9ef&#34;&gt;environments&lt;/span&gt;:
- &lt;span style=&#34;color:#66d9ef&#34;&gt;key&lt;/span&gt;: dev
- &lt;span style=&#34;color:#66d9ef&#34;&gt;key&lt;/span&gt;: staging
- &lt;span style=&#34;color:#66d9ef&#34;&gt;key&lt;/span&gt;: production
&lt;span style=&#34;color:#66d9ef&#34;&gt;kaniko&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;secretStorage&lt;/span&gt;: vault
&lt;span style=&#34;color:#66d9ef&#34;&gt;webhook&lt;/span&gt;: lighthouse
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;installing-vault&#34;&gt;Installing Vault&lt;/h2&gt;
&lt;p&gt;Before you try to &lt;a href=&#34;/docs/labs/boot/getting-started/run/&#34;&gt;run the boot job&lt;/a&gt; you need to ensure your Vault installation is set up and the secrets are populated.&lt;/p&gt;
&lt;p&gt;So please install the &lt;a href=&#34;https://banzaicloud.com/products/bank-vaults/&#34;&gt;vault operator&lt;/a&gt; in some namespace such as &lt;code&gt;vault-infra&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Create a namespace for the vault operator&lt;/span&gt;
kubectl create namespace vault-infra
kubectl label namespace vault-infra name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;vault-infra

&lt;span style=&#34;color:#75715e&#34;&gt;# Install the vault-operator to the vault-infra namespace&lt;/span&gt;
helm repo add banzaicloud-stable https://kubernetes-charts.banzaicloud.com
helm upgrade --namespace vault-infra --install vault-operator banzaicloud-stable/vault-operator --wait
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now you need to create a vault custom resource instance in the namespace you are installing Jenkins X which is &lt;code&gt;jx&lt;/code&gt; by default.&lt;/p&gt;
&lt;p&gt;The following commands assumes you are using the &lt;code&gt;jx&lt;/code&gt; namespace. If you wish to modify to use a different namespace please modify the &lt;code&gt;operator/deploy/cr.yaml&lt;/code&gt; file appropriately (replacing &lt;code&gt;jx&lt;/code&gt; with the namespace you are using).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# make sure we are in the jx namespace&lt;/span&gt;

jxl ns jx

git clone https://github.com/jenkins-x-labs/bank-vaults
cd bank-vaults

&lt;span style=&#34;color:#75715e&#34;&gt;# Create a Vault instance&lt;/span&gt;
kubectl apply -f operator/deploy/rbac.yaml
kubectl apply -f operator/deploy/cr.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now you need to wait for the &lt;code&gt;vault-0&lt;/code&gt; pod to be ready:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl wait --for&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;condition&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Ready pod/vault-0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now your vault can be used.&lt;/p&gt;
&lt;h2 id=&#34;using-vault&#34;&gt;Using Vault&lt;/h2&gt;
&lt;p&gt;To be able to import, export or edit secrets from your laptop you need to make sure you are running the following command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl port-forward service/vault 8200
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This will allow the &lt;a href=&#34;/docs/labs/jxl/&#34;&gt;jxl binary&lt;/a&gt; to access the Vault REST API.&lt;/p&gt;
&lt;p&gt;You can now follow the instructions to &lt;a href=&#34;/docs/labs/boot/getting-started/secrets/#populate-secrets&#34;&gt;populate secrets&lt;/a&gt; or &lt;a href=&#34;/docs/labs/boot/getting-started/secrets/#importing-secrets&#34;&gt;import secrets&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;using-the-vault-cli&#34;&gt;Using the vault CLI&lt;/h2&gt;
&lt;p&gt;Download the &lt;a href=&#34;https://www.vaultproject.io/downloads/&#34;&gt;vault CLI binary&lt;/a&gt; and add it to your &lt;code&gt;$PATH&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You can now setup a shell to access vault as follows:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;export VAULT_TOKEN&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;kubectl get secrets vault-unseal-keys -o jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;={&lt;/span&gt;.data.vault-root&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | base64 --decode&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# Tell the CLI that the Vault Cert is signed by a custom CA&lt;/span&gt;
kubectl get secret vault-tls -o jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.data.ca\.crt}&amp;#34;&lt;/span&gt; | base64 --decode &amp;gt; $PWD/vault-ca.crt
export VAULT_CACERT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$PWD/vault-ca.crt

&lt;span style=&#34;color:#75715e&#34;&gt;# Tell the CLI where Vault is listening (the certificate has 127.0.0.1 as well as alternate names)&lt;/span&gt;
export VAULT_ADDR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://127.0.0.1:8200

&lt;span style=&#34;color:#75715e&#34;&gt;# Now we can use the vault CLI to list/read/write secrets...&lt;/span&gt;
                                           
&lt;span style=&#34;color:#75715e&#34;&gt;# List all the current secrets&lt;/span&gt;
vault kv list secret

&lt;span style=&#34;color:#75715e&#34;&gt;# Lets store a secert&lt;/span&gt;
vault kv put secret/mything foo&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;bar whatnot&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cheese
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
  </channel>
</rss>
