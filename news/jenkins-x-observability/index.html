<!DOCTYPE html>
<html class="no-js" lang="en-us">
  <head>
    <meta charset="utf-8">
    
    <link rel="preload" href="https://jenkins-x.io/files/muli-latin-200.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://jenkins-x.io/files/muli-latin-400.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://jenkins-x.io/files/muli-latin-800.woff2" as="font" type="font/woff2" crossorigin>
    
    <link rel="canonical" href="https://jenkins-x.io/news/jenkins-x-observability/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
     
    <title>Increasing CI/CD Pipeline Observability in Jenkins X | Jenkins X</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
     <meta name="generator" content="Hugo 0.49" />

      
        <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
      

    <link href='https://jenkins-x.io/dist/main.css' rel='stylesheet' type="text/css" /><script src="https://jenkins-x.io/js/chart.js"></script>
<style>
  img.avatar {
    width: 32px;
    display: inline;
  }
</style>
<meta property="og:title" content="Increasing CI/CD Pipeline Observability in Jenkins X" />
<meta property="og:description" content="Increase observability by activating metric capture and analysis during a containerized application deployment with Jenkins X. 
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jenkins-x.io/news/jenkins-x-observability/" /><meta property="article:published_time" content="2019-07-29T10:44:40-07:00"/>
<meta property="article:modified_time" content="2019-08-23T20:48:08&#43;00:00"/>

<meta itemprop="name" content="Increasing CI/CD Pipeline Observability in Jenkins X">
<meta itemprop="description" content="Increase observability by activating metric capture and analysis during a containerized application deployment with Jenkins X. 
">


<meta itemprop="datePublished" content="2019-07-29T10:44:40-07:00" />
<meta itemprop="dateModified" content="2019-07-29T10:44:40-07:00" />
<meta itemprop="wordCount" content="1343">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jenkins-x.io/images/logo.png"/>

<meta name="twitter:title" content="Increasing CI/CD Pipeline Observability in Jenkins X"/>
<meta name="twitter:description" content="Increase observability by activating metric capture and analysis during a containerized application deployment with Jenkins X. 
"/>
<meta name="twitter:site" content="@jenkinsxio"/>

        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4216293-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4216293-7');



var trackOutboundLink = function(id, url) {
  console.log("track:", id, url)
  gtag('event', 'click', {
    'event_category': 'outbound',
    'event_label': id,
    'transport_type': 'beacon',
    'event_callback': function(){document.location = url;}
  });
}

</script>

      
     <link href='https://jenkins-x.io/css/build_status.css' rel='stylesheet' type="text/css" />

  </head>
  <body class="ma0 sans-serif bg-primary-color-light production">
    
<nav class="bg-primary-color-dark pv4 w-100" role="navigation">

  <div class="center flex-ns flex-wrap items-center justify-start mw9">

    <h1 class="dim f3 lh-solid ml0-ns mr0 mr4-l mv0 pl3 pl4-ns">
      <a href="https://jenkins-x.io/" class="link white">
         Jenkins X
      </a>
    </h1>
    <ul class="list ma0 pa0 dn dib-l">
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins-x.io/documentation" class="dim link light-silver">
            Documentation
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins-x.io/news/" class="dim link light-silver">
            News
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins-x.io/community" class="dim link light-silver">
            Community
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://github.com/jenkins-x/jx" class="dim link light-silver">
            GitHub
              
            
            
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32" class="fill-current v-base" aria-label="External Link">
<path d="M25.152 16.576v5.696q0 2.144-1.504 3.648t-3.648 1.504h-14.848q-2.144 0-3.648-1.504t-1.504-3.648v-14.848q0-2.112 1.504-3.616t3.648-1.536h12.576q0.224 0 0.384 0.16t0.16 0.416v1.152q0 0.256-0.16 0.416t-0.384 0.16h-12.576q-1.184 0-2.016 0.832t-0.864 2.016v14.848q0 1.184 0.864 2.016t2.016 0.864h14.848q1.184 0 2.016-0.864t0.832-2.016v-5.696q0-0.256 0.16-0.416t0.416-0.16h1.152q0.256 0 0.416 0.16t0.16 0.416zM32 1.152v9.12q0 0.48-0.352 0.8t-0.8 0.352-0.8-0.352l-3.136-3.136-11.648 11.648q-0.16 0.192-0.416 0.192t-0.384-0.192l-2.048-2.048q-0.192-0.16-0.192-0.384t0.192-0.416l11.648-11.648-3.136-3.136q-0.352-0.352-0.352-0.8t0.352-0.8 0.8-0.352h9.12q0.48 0 0.8 0.352t0.352 0.8z"></path>
</svg>

            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins.io" class="dim link light-silver">
            Jenkins
              
            
            
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32" class="fill-current v-base" aria-label="External Link">
<path d="M25.152 16.576v5.696q0 2.144-1.504 3.648t-3.648 1.504h-14.848q-2.144 0-3.648-1.504t-1.504-3.648v-14.848q0-2.112 1.504-3.616t3.648-1.536h12.576q0.224 0 0.384 0.16t0.16 0.416v1.152q0 0.256-0.16 0.416t-0.384 0.16h-12.576q-1.184 0-2.016 0.832t-0.864 2.016v14.848q0 1.184 0.864 2.016t2.016 0.864h14.848q1.184 0 2.016-0.864t0.832-2.016v-5.696q0-0.256 0.16-0.416t0.416-0.16h1.152q0.256 0 0.416 0.16t0.16 0.416zM32 1.152v9.12q0 0.48-0.352 0.8t-0.8 0.352-0.8-0.352l-3.136-3.136-11.648 11.648q-0.16 0.192-0.416 0.192t-0.384-0.192l-2.048-2.048q-0.192-0.16-0.192-0.384t0.192-0.416l11.648-11.648-3.136-3.136q-0.352-0.352-0.352-0.8t0.352-0.8 0.8-0.352h9.12q0.48 0 0.8 0.352t0.352 0.8z"></path>
</svg>

            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins-x.io/sponsors/" class="dim link light-silver">
            Sponsors
              
            
            
          </a>
        </li>
      
        <li class="f5 dib mr4" role="menuitem">
            
          <a href="https://jenkins-x.io/security/" class="dim link light-silver">
            Security
              
            
            
          </a>
        </li>
      
    </ul>

    <div class="db dib-ns pl3"><form id="site-search-form" action="" role="search">
  <fieldset class="bn ma0 pa0">
    <label class="clip" for="email-address">Search</label>
    <input type="search" id="search-input" class="needs-js bg-left bg-transparent bn f5 input-reset lh-solid mt3 mt0-ns pl4 pv2 w5 white" placeholder="Search the Docs" type="text" name="email-address" value="" style="background-image:url('/images/icon-search.png');background-size:16px 16px;">
  </fieldset>
</form>
</div>

    <div class="list ma0 pa0 dn dib-l"></div>

    <span class="absolute mt1 mt2-l pr3 right-0 top-0">

  <a href="https://twitter.com/intent/follow?screen_name=jenkinsxio" title="Follow on Twitter" class="link-transition twitter link dib z-999 pt3 pt0-l mr2">
    <svg height="32px" id="Layer_1" style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>

<a class="github-button needs-js link primary-color-dark" href="https://github.com/jenkins-x/jx" data-size="large" data-show-count="false" aria-label="Star jenkins-x/jx on GitHub">Star</a>
</span>

  </div>
</nav>

    
    <main role="main" class="content-with-sidebar min-vh-100 pb7 pb0-ns">
      
  

  <article class="cf ph4 pv3 pv5-ns">
      
    <header class="flex-none w-100 pb3">
      
        
          <a href="https://jenkins-x.io/categories/blog" class="f6 fw8 mb0 link mid-gray dim mr3">
            BLOG
          </a>
        
      

      <h1 class="lh-title fw9 mb7 mv0 pt3">
        <a href="https://jenkins-x.io/news/jenkins-x-observability/" class="link primary-color dim">
          Increasing CI/CD Pipeline Observability in Jenkins X
        </a>
      </h1>
    </header>

    <div class="flex-l">
      <aside class="mid-gray fn w-100 w-25-l">
        
          <h2 class="f3 lh-title">
            Increase observability by activating metric capture and analysis during a containerized application deployment with Jenkins X.
          </h2>
        
        <time class="f6 mt2 db ttu tracked" datetime="2019-07-29T10:44:40-07:00">
          July 29, 2019
        </time>
        By: <strong>Oscar Medina</strong>

        
        

        <div class="nested-links mt4">

	<div date-pref>
		
			<a href="https://jenkins-x.io/news/new-logo-jenkins-x/" class="dib f6 pl1 hover-bg-light-gray br-100" title="A New Logo for Jenkins X ">
				<svg class="fill-current" height="30px" viewBox="0 0 24 24" width="30px" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>

			</a>
		

		
			<a href="https://jenkins-x.io/news/serverless-deployments/" class="dib f6 pr1 hover-bg-light-gray br-100" title="Using Jenkins X To Define And Run Serverless Deployments">
			<svg class="fill-current" height="30px" viewBox="0 0 24 24" width="30px" xmlns="http://www.w3.org/2000/svg">
    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>

			</a>
		
	</div>

</div>

      </aside>

      <div class="fn pl5-l pt3 mid-gray w-100 w-two-third-l sans-serif nested-copy-line-height no-underline nested-links nested-img nested-copy-seperator nested-blockquote measure-wide-l">
        <a href="https://github.com/jenkins-x/jx-docs/edit/master/content/news/jenkins-x-observability.md" class="
f6 ph3 pv1 br2 dib  tc ttu mv3 bg-primary-color white hover-bg-green link
 page-edit">Improve this page</a>

        
          
          
          
        

<p><figure>
<img src="https://assets.devopsdays.org/events/2018/toronto/DevOpsDaysTO_May31_2018_ClaySmith.jpg"/>
<figcaption>
<h5>Increasing CI/CD Pipeline Observability, implement tracing</h5>
</figcaption>
</figure>
Credit: <a href="https://www.mindseyecreative.ca/">Minds Eye Creative</a> | <a href="https://devopsdays.org/events/2018-toronto/program/clay-smith/">DevOps Days Toronto</a></p>

<h1 id="overview">Overview</h1>

<p>You might have heard of Observability given that folks have been talking about this for a while now.  Sure, you might think it is just the latest tech buzzword.  However, the practice has been around for a long time now.</p>

<p>Observability is certainly relevant today given the Microservices architectures, distributed systems, and the characteristics of modern applications being deployed at a faster pace by leveraging CI/CD pipelines to Kubernetes, in this case using Jenkins X.  Indeed old practices of setting up monitoring after an app is deployed, are no longer acceptable.</p>

<p>Let’s face it, modern apps call for modern instrumentation, not only once they are deployed; even at build-time having proper instrumentation can help you gain insights into what is happening at various stages of the build and release process. This may include spotting any latency issues, performance and dependency download times.  In other words, instrumentation and monitoring should be baked into our deployment pipeline in Jenkins X!</p>

<p>Given that Jenkins X is the native CI/CD platform for Kubernetes, we must start thinking of Observability in the context of the build and release of our containerized applications via this platform, and not after the deployment process itself.</p>

<h1 id="what-we-are-doing-today">What we are doing today</h1>

<p>Today, I walk you through the process of increasing observability in your build and release pipeline by implementing tracing for a couple of events such as <code>npm install</code> and <code>npm test</code> which are part of a sample NodeJS application.</p>

<aside class="admonition note">
	<div class="note-icon">
		
	</div>
	
	
	<div class="admonition-content"><p>NOTE: Tracing is only a small portion of other things that need to be in place.  Logging and Metrics are also required.  The combination and aggregation of this data allows you to understand how observable your pipeline is.</p>
</div>
</aside>


<p><figure>
<img src="https://peter.bourgon.org/img/instrumentation/01.png"/>
<figcaption>
<h5>Metrics, Logs, Traces are all needed.</h5>
</figcaption>
</figure>
Diagram by: <a href="https://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html">Peter Bourgon</a></p>

<h2 id="leveraging-third-party-tools">Leveraging Third-Party Tools</h2>

<p>Jenkins X was built with extensibility and flexibility in mind.  Today, you can easily create <strong>QuickStarts</strong> for a language not implemented.  You can also build <strong>addOns</strong> to augment the platform functionality.  There are currently <strong>addOns</strong> for <code>istio</code>, <code>prometheus</code> and <code>anchore</code> to name a few.  Given this extensibility, we encourage our community to build these components and share with everyone.</p>

<p>If you look around, you’ll find that <a href="http://Honeycomb.io">Honeycomb.io</a> is at the forefront of Observability.  We are collaborating with them to eventually have a <em>Honeycomb addOn</em> for Jenkins X</p>

<p>In this post, we use the Honeycomb.io API to trace our pipeline events.</p>

<h3 id="tracing-ci-cd-pipeline-events">Tracing CI/CD Pipeline Events</h3>

<p>In this scenario we want to trace start and end times for certain events.  In our example NodeJS app, we have commands such as <code>npm install</code> and <code>npm test</code>, which are part of our <strong>build-pack</strong> pipeline out of the box.  To do start tracing, we modify the Tekton pipeline and inject calls to the Honeycomb.io API before and after these specific <strong>build pack</strong> named steps.</p>

<aside class="admonition note">
	<div class="note-icon">
		
	</div>
	
	
	<div class="admonition-content"><p>NOTE: Please be sure to sign up for <a href="http://honeycomb.io">honeycomb.io</a> to obtain your <strong>API Key</strong></p>
</div>
</aside>


<h4 id="create-kubernetes-secret">Create Kubernetes Secret</h4>

<p>Once we have our API Key, we want to create a Kubernetes Secret which is required to make API calls within our pipeline.  To do this, we create it in the <code>jx</code> and <code>jx-staging</code> namespaces.  For each namespace execute the following command (be sure to modify the namespace value as needed).</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&gt;$ kubectl create secret generic honeycomb-creds —from-literal<span class="o">=</span><span class="nv">BUILDEVENT_APIKEY</span><span class="o">=</span>&lt;KEY&gt;  --namespace<span class="o">=</span>&lt;NAMESPACE&gt;</code></pre></div>
<h4 id="modify-tekton-pipeline">Modify Tekton Pipeline</h4>

<p>Now that we have our Kubernetes Secret in place, we will modify the <code>jenkins-x.yaml</code> file, which currently has exactly one line as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">buildpack<span class="p">:</span><span class="w"> </span>javascript</code></pre></div>
<p>Let&rsquo;s go over the important components of the YAML file once modified.  The first items I&rsquo;d like to highlight, are the environment variables needed.  We need to provide honeycomb.io three key pieces of information:</p>

<ul>
<li><strong>CI Provider</strong>:  this is the JENKINS-X environment variable.  Honeycomb will add additional metadata fields to our dataset</li>
<li><strong>BUILDEVENT_DATASET</strong>: this indicates which dataset we want to populate (you can have many).</li>
<li><strong>BUILDEVENT_APIKEY</strong>: the Kubernetes Secret value, which is the API Key provided via the honeycomb site</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">buildPack<span class="p">:</span><span class="w"> </span>javascript<span class="w">
</span><span class="w"></span>pipelineConfig<span class="p">:</span><span class="w">
</span><span class="w">  </span>env<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>JENKINS-X<span class="w">
</span><span class="w">    </span>value<span class="p">:</span><span class="w"> </span>JENKINS-X<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>BUILDEVENT_DATASET<span class="w">
</span><span class="w">    </span>value<span class="p">:</span><span class="w"> </span>jx<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>BUILDEVENT_APIKEY<span class="w">
</span><span class="w">    </span>valueFrom<span class="p">:</span><span class="w">
</span><span class="w">      </span>secretKeyRef<span class="p">:</span><span class="w">
</span><span class="w">        </span>key<span class="p">:</span><span class="w"> </span>BUILDEVENT_APIKEY<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>honeycomb-creds</code></pre></div>
<p>The <strong>build-pack</strong> used for a NodeJS app is <strong>javascript</strong> as detected by the language.  Hence, why the single line we had as the contents of the <code>jenkins-x.yaml</code> file.</p>

<p>Because we know which build-pack is being used, we can determine which named steps exist.  As you can imagine, a typical <code>npm install</code> and <code>npm test</code> typically exist.</p>

<p>Therefore, we want to inject a timestamp <strong>before</strong> and <strong>after</strong> each of these named steps are called.  The following shows how I inject this.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>pipelines<span class="p">:</span><span class="w">
</span><span class="w">    </span>overrides<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>npm-install<span class="w">
</span><span class="w">      </span>pipeline<span class="p">:</span><span class="w"> </span>pullRequest<span class="w">
</span><span class="w">      </span>stage<span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">      </span>steps<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>command<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>=====<span class="w"> </span>pullrequest<span class="p">:</span>build<span class="p">:</span>before<span class="w">  </span>sending<span class="w"> </span>honeycomb<span class="w"> </span>step<span class="w"> </span>trace<span class="w">  </span>===============<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-npm-install-set-step-start-timestamp<span class="w">
</span><span class="w">        </span>sh<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>$(date<span class="w"> </span>+%s)<span class="w"> </span><span class="sd">&gt; step_start
</span><span class="sd">      - name: honeycomb-npm-install-before-timestamp
</span><span class="sd">        sh: echo =================================  $(cat step_start)  =================================
</span><span class="sd">      type: before
</span><span class="sd">      
</span><span class="sd">    - name: npm-install
</span><span class="sd">      pipeline: pullRequest
</span><span class="sd">      stage: build
</span><span class="sd">      steps:
</span><span class="sd">      - command: echo ===== pullrequest:build:after   sending honeycomb step trace  ===============
</span><span class="sd">      - name: honeycomb-npm-install-after-timestamp
</span><span class="sd">        sh: echo =================================  $(cat step_start)  =================================
</span><span class="sd">      - name: honeycomb-step-log-after-npm-install
</span><span class="sd">        sh: ./buildevents step &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; $(echo npm-install | sum | cut -f 1 -d \ ) $(cat step_start) npm-install
</span><span class="sd">      type: after
</span><span class="sd">    - name: npm-test
</span><span class="sd">      pipeline: pullRequest
</span><span class="sd">      stage: build
</span><span class="sd">      steps:
</span><span class="sd">      - name: honeycomb-npm-test-set-step-start-timestamp
</span><span class="sd">        sh: echo $(date +%s) &gt; step_start
</span><span class="sd">      - name: honeycomb-npm-test-before-timestamp
</span><span class="sd">        sh: echo =================================  $(cat step_start)  =================================
</span><span class="sd">      type: before
</span><span class="sd">    - name: npm-test
</span><span class="sd">      pipeline: pullRequest
</span><span class="sd">      stage: build
</span><span class="sd">      steps:
</span><span class="sd">      - name: honeycomb-npm-test-after-timestamp
</span><span class="sd">        sh: echo =================================  $(cat step_start)  =================================
</span><span class="sd">      - name: honeycomb-step-log-after-npm-test
</span><span class="sd">        sh: ./buildevents step &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; $(echo npm-test | sum | cut -f 1 -d \ ) $(cat step_start) npm-test
</span><span class="sd">      type: after</span></code></pre></div>
<p>Now that I have  captured timestamps for these two named steps, I want to send an API call to honeycomb as follows.  You will notice how I am using a binary called <strong>buildevents</strong> this is downloaded during the setup of my pipelines which I discuss shortly.</p>

<p>By concatenating a few metadata pieces that exist as <strong>environment variables</strong> in Jenkins X, I build a unique name which is needed by honeycomb to track things correctly.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span>-<span class="w"> </span>pipeline<span class="p">:</span><span class="w"> </span>pullRequest<span class="w">
</span><span class="w">      </span>stage<span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">      </span>steps<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-build-name-concat<span class="w">
</span><span class="w">        </span>sh<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>the<span class="w"> </span>build<span class="w"> </span>is<span class="w"> </span><span class="s2">&#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34;</span><span class="w"> </span>and<span class="w"> </span>HONEYCOMB_BUILD_START=$(cat<span class="w"> </span>build_start)<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-send-success<span class="w">
</span><span class="w">        </span>sh<span class="p">:</span><span class="w"> </span>./buildevents<span class="w"> </span>build<span class="w"> </span><span class="s2">&#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34;</span><span class="w"> </span>$(cat<span class="w"> </span>build_start)<span class="w"> </span>success<span class="w">
</span><span class="w">      </span>type<span class="p">:</span><span class="w"> </span>after</code></pre></div>
<p>We do the same for the <strong>Release</strong> pipeline&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># release pipeline releated calls</span><span class="w">
</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>npm-install<span class="w">
</span><span class="w">      </span>pipeline<span class="p">:</span><span class="w"> </span>release<span class="w">
</span><span class="w">      </span>stage<span class="p">:</span><span class="w"> </span>build<span class="w">
</span><span class="w">      </span>steps<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>command<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>=====<span class="w"> </span>release<span class="p">:</span>build<span class="p">:</span>before<span class="w">  </span>sending<span class="w"> </span>honeycomb<span class="w"> </span>step<span class="w"> </span>trace<span class="w">  </span>===============<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>release-honeycomb-npm-install-step-start-timestamp<span class="w">
</span><span class="w">        </span>sh<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>$(date<span class="w"> </span>+%s)<span class="w"> </span><span class="sd">&gt; release_step_start
</span><span class="sd">      - name: release-honeycomb-npm-install-before-timestamp
</span><span class="sd">        sh: echo ================================= release  release-npm-install step start  $(cat release_step_start)  =================================
</span><span class="sd">      type: before
</span><span class="sd">
</span><span class="sd">    - name: npm-install
</span><span class="sd">      pipeline: release
</span><span class="sd">      stage: build
</span><span class="sd">      steps:
</span><span class="sd">      - name: release-honeycomb-npm-install-after-timestamp
</span><span class="sd">        sh: echo ================================= release npm-install step end  $(cat release_step_start)  =================================
</span><span class="sd">      - name: release-honeycomb-step-log-after-npm-install
</span><span class="sd">        sh: ./buildevents step &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; $(echo release-npm-install | sum | cut -f 1 -d \ ) $(cat release_step_start) release-npm-install
</span><span class="sd">      type: after
</span><span class="sd">
</span><span class="sd">    - pipeline: release
</span><span class="sd">      stage: build
</span><span class="sd">      steps:
</span><span class="sd">      - name: release-honeycomb-build-name-concat
</span><span class="sd">        sh: echo the build is &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; and HONEYCOMB_BUILD_START=$(cat release_start)
</span><span class="sd">      - name: release-honeycomb-build-send-success
</span><span class="sd">        sh: ./buildevents build &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; $(cat release_start) success
</span><span class="sd">      type: after</span></code></pre></div>
<p>This is portion of the pipeline executes first hence the <strong>setup</strong> node.  There are several things we want to accomplish in the setup of our pipelines.</p>

<ul>
<li>Download the Build Events binary provided by Honeycomb, make it executable</li>
<li>Create the timestamp we will use to track the <strong>pullRequest</strong> pipeline execution.  I do this by saving a temporary file with the timestamp.</li>
</ul>

<p>This is done for both pipelines, as we are working with both.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span>pullRequest<span class="p">:</span><span class="w">
</span><span class="w">      </span>setup<span class="p">:</span><span class="w">
</span><span class="w">        </span>steps<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>command<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>===========================<span class="w"> </span>pullrequest<span class="p">:</span>setup<span class="w"> </span>downloading<span class="w"> </span>Honeycomb.io<span class="w"> </span>buildevents<span class="w"> </span>binary<span class="w"> </span>===========================<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>pullrequest-download-honeycomb-binary<span class="w">
</span><span class="w">            </span>sh<span class="p">:</span><span class="w"> </span>curl<span class="w"> </span>-L<span class="w"> </span>-o<span class="w"> </span>buildevents<span class="w"> </span>https<span class="p">:</span>//github.com/honeycombio/buildevents/releases/latest/download/buildevents-linux-amd64<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-set-binary-permissions<span class="w">
</span><span class="w">            </span>sh<span class="p">:</span><span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>buildevents<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-display-buildevents-version<span class="w">
</span><span class="w">            </span>sh<span class="p">:</span><span class="w"> </span>./buildevents<span class="w"> </span>--version<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>honeycomb-setup-build-timestamp<span class="w">
</span><span class="w">            </span>sh<span class="p">:</span><span class="w"> </span>echo<span class="w"> </span>$(date<span class="w"> </span>+%s)<span class="w"> </span><span class="sd">&gt; build_start
</span><span class="sd">          - name: honeycomb-output-debug
</span><span class="sd">            sh: echo the build is &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; and HONEYCOMB_BUILD_START=$(cat build_start)   =======================================================
</span><span class="sd">    release:
</span><span class="sd">      setup:
</span><span class="sd">        steps:
</span><span class="sd">        - command: echo =========================== release:setup downloading Honeycomb.io buildevents binary ===========================
</span><span class="sd">        - name: release-download-honeycomb-binary
</span><span class="sd">          sh: curl -L -o buildevents https://github.com/honeycombio/buildevents/releases/latest/download/buildevents-linux-amd64
</span><span class="sd">        - name: release-honeycomb-set-binary-permissions
</span><span class="sd">          sh: chmod 755 buildevents
</span><span class="sd">        - name: release-honeycomb-setup-build-timestamp
</span><span class="sd">          sh: echo $(date +%s) &gt; release_start
</span><span class="sd">        - name: release-honeycomb-output-debug
</span><span class="sd">          sh: echo the build is &#34;${APP_NAME}-${PULL_NUMBER}-${VERSION}-${BUILD_NUMBER}&#34; and HONEYCOMB_BUILD_START=$(cat release_start)   =======================================================</span></code></pre></div>
<p>Once this pipeline executes, the dashboard on the honeycomb.io site will show us the execution tracing as follows.</p>

<p><img src="https://jenkins-x.io/news/jenkins-x-observability/honeycomb_trace_example.png" alt="Honeycomb Dashboard" /></p>

<p>As you can see, we have a unique name for our build being traced, underneath that we are tracking the two events <code>npm install</code> and <code>npm test</code> time spans.  We can easily see how long our dependencies are taking to download, and how long does it take to run the tests for the app.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Hopefully I’ve enticed you to at least look into why you might consider incorporating observability into your build and release process. There is a lot more that can be done.  In a future post, we will cover additional setup.</p>

<h2 id="jenkins-world-devops-world-2019">Jenkins World | DevOps World 2019</h2>

<p>I&rsquo;ll be demoing this solution at various times while at the conference this year.  You can still register and get a big discount by using code: <strong>PREVIEW</strong>.  You can find my full schedule on the <a href="https://www.cloudbees.com/devops-world/san-francisco/agenda">official website</a></p>

<p>Cheers,<br/>
<a href="https://twitter.com/SharePointOscar">@SharePointOscar</a></p>

      </div>
    </div>
    

      <div class="gray f6 mv6">
        Last Update: August 23, 2019 <br>
      </div>

  </article>


    </main>

    <footer class="bg-primary-color-dark ph4-ns pt4 relative w-100" role="contentinfo">
  <div class="center flex-ns flex-wrap justify-between mw9 w-90">
    <div class="pb3 pt4 w-100 w-50-ns">

      <div class="b f3  light-gray mb3 nested-links tc">
        By the <a href="https://github.com/jenkins-x/jx/contributors" class="link">Jenkins X Authors</a><br/>
      </div>

      <ul class="center f6 list ma0 mv3 pa0 tc"><li class="dib mr3"><a href="https://github.com/jenkins-x/jx/issues/new" class="dim link light-gray pv2">File an Issue</a></li><li class="dib mr3"><a href="https://jenkins-x.io/community" class="dim link light-gray pv2">Get Help</a></li><li class="dib"><a href="https://jenkins-x.io/community" class="dim link light-gray pv2">Discuss Source Code</a></li></ul>

      <ul class="center f6 list ma0 mv4 pa0 tc">
        <li class="dib mr3"><a href="https://twitter.com/jenkinsxio" class="dim link light-gray pv2">@jenkinsxio</a>
        </li>
      </ul>

      
    </div>

    <div> 
      <img src="https://jenkins-x.io/images/logo.svg" width="100" height="100" />
    </div>

  </div>

  <div class="f7 gray mb5 mb0-ns ph3 w-100"> 
    <p class="dib mr4">Jenkins&reg; is a registered trademark of <a href="https://www.spi-inc.org/" class="link">Software in the Public Interest, Inc.</a></p>
    <p class="dib">Copyright 2018–2019 the original authors.</p>
  </div>


  <div class="bg-primary-color-dark bottom-0 left-0 right-0 dn-l fixed pb3 ph3 w-100"><div  class="globalmenu mobilemenu pb3 dn">
    

<ul class="list hidden dib ph0 ma0 scrolling-touch tc">
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/documentation" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Documentation
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/news/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          News
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/community" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Community
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://github.com/jenkins-x/jx" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          GitHub
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins.io" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Jenkins
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/sponsors/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Sponsors
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/security/" class="ttu f6 link primary-color-light overflow hover-white db brand-font  ma0 w-100 pv3 ph4">
          Security
        </a>
    </li>
  
</ul>

</div>
<div  class="docsmenu mobilemenu pb3 dn">
    

<ul class="list dib ph0 ma0 scrolling-touch tc">
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/about/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          About Jenkins X
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="https://jenkins-x.io/getting-started/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Getting Started
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="https://jenkins-x.io/developing/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Developing
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="https://jenkins-x.io/demos/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Demos
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="https://jenkins-x.io/architecture/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Architecture
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100 mb2 bb b--mid-gray">
        <a href="https://jenkins-x.io/apps/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Extending
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/apidocs/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          API
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/commands/jx/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          CLI
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/faq/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          FAQ
        </a>
    </li>
  
    <li  class="tl dib ma0 hover-bg-black w-100">
        <a href="https://jenkins-x.io/contribute/" class="ttu f6 link primary-color-light  hover-white db brand-font mb1  ma0 w-100 pv2 ph4">
          Contribute
        </a>
    </li>
  
</ul>

</div>

<div class="flex dn-l justify-between">
  <button class="js-toggle flex-auto dib dn-l f6 tc db mt4-ns ph3 pv2 link mr2 white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".globalmenu">Menu</button>

  <button class="js-toggle flex-auto dib dn-l f6 tc db mt4-ns ph3 pv2 link white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".docsmenu">Docs Menu</button>
</div>
</div>

</footer>

    <script src="https://jenkins-x.io/dist/app.bundle.js"></script>

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/d0c128ac1f69ba2bb20742976/9159f4f527ec7e8e4d019eb5c.js");</script>
<script>
    !function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
    },s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
    a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
    
    twq('init','o14ln');
    twq('track','PageView');
 </script>

  </body>
</html>
